<!DOCTYPE html>
<html>
  <head>
    <!-- Bootstrap JS and dependencies -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"></script>
    <script type="text/javascript" src="./js/bootstrap.min.js"></script>
    <!-- /Bootstrap JS and dependencies -->

    <!-- Our CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <link href="./css/amazon-hq2-propsals.css" rel="stylesheet" />
    <!-- /Our CSS -->

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js" integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log==" crossorigin=""></script>
    <!-- /Leaflet -->

    <script type="text/javascript">
/**
 * To add a new proposal to the view, simply create a new object that contains
 * the location, the country, the lat/long of the location, and a link to the
 * proposal.
 *
 * Example:
 *
 *   {
 *     "location": "Portland, OR",
 *     "country": "United States",
 *     "loc": [45.5231, -122.6765],
 *     "pdf": "https://greaterportlandinc.com/assets/documents/greaterportlandinc-amazonhq2.pdf",
 *     "video": "",
 *     "website": "",
 *     "locations": ""
 *   }
 *
 */
window.PROPOSALS = [
  {
    "location": "Portland, OR",
    "country": "United States",
    "loc": [45.5231, -122.6765],
    "pdf": "https://greaterportlandinc.com/assets/documents/greaterportlandinc-amazonhq2.pdf",
    "video": "",
    "website": "",
    "locations": ""
  },
  {
    "location": "Toronto",
    "country": "Canada",
    "loc": [43.6532, -79.3832],
    "pdf": "https://s3.ca-central-1.amazonaws.com/torontoglobal/TorontoRegionResponsetoAmazonHQ2RFP_PD.pdf",
    "video": "",
    "website": "",
    "locations": ""
  },
  {
    "location": "Pittsburgh, PA",
    "country": "United States",
    "loc": [40.4406, -79.9959],
    "pdf": "",
    "video": "https://www.youtube.com/watch?v=XEw2Ky5XxDM",
    "website": "https://hqpittsburgh.com/",
    "locations": ""
  }
];
    </script>
  </head>

  <body lang="en">

    <nav class="navbar">
      <a class="navbar-brand" href="#">Amazon HQ2 Proposals</a>

      <div class="collapse navbar-collapse">
        <!--
          <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
              <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
            </li>
          </ul>
        -->
      </div>
    </nav>

    <div class="jumbotron">
      <div class="container">
        <div id="my-map"></div>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <table class="table table-hover" id="proposals">
          <thead class="thead-inverse">
            <tr>
              <th>Region</th>
              <th>Country</th>
              <th></th>
            </tr>
          </thead>

          <tbody id="proposals-tbody">
          </tbody>
        </table>
      </div>
     </div>

     <footer class="footer">
      <div class="container">
        <span class="text-muted">All content property of it's respective owners.</span>
      </div>
    </footer>
  </body>

  <script type="text/javascript">
var slug = function(str) {
  return str.toLowerCase().replace(/[^a-zA-Z0-0]/, '-').replace(/-+/, '-');
}

var createId = function(prop) {
  return slug(prop.country) + '-' + slug(prop.location);
}

var createLink = function(fa, href) {
  var span = $('<span class="resource" />'),
      icon = $('<i class="fa" aria-hidden="true" />');

  icon.addClass(fa);

  if (href != "") {
    var link = $('<a target="_blank" />');
    link.attr("href", href)
    link.append(icon);

    span.append(link);
  } else {
    icon.addClass('icon-disabled');
    span.append(icon);
  }

  return span;
}

function renderPropsals(tbody, props) {
  var len = props.length,
      $tbody = $(tbody);

  // Stupp for the map.
  var mymap = L.map('my-map').setView([39.50,-98.35], 4);

  L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
    maxZoom: 18,
    id: 'mapbox.streets',
    accessToken: 'pk.eyJ1IjoiYnJhZGhlIiwiYSI6ImNpamZ5YzNpYjAwMzJ1NG01OTh1NmYwZGkifQ.xnt-BjEXZZ5vw3gryLfMpA'
  }).addTo(mymap);

  for (var i = 0; i < len; i++) {
    var prop = props[i],
        $tr = $('<tr/>'),
        $locationTd = $('<td/>'),
        $countryTd = $('<td/>'),
        $linkTd = $('<td align="right"/>');

    $locationTd.text(prop.location);
    $countryTd.text(prop.country);
    $linkTd.append(createLink('fa-file-pdf-o', prop.pdf));
    $linkTd.append(createLink('fa-video-camera', prop.video));
    $linkTd.append(createLink('fa-location-arrow', prop.website));
    $linkTd.append(createLink('fa-map-marker', prop.locations));

    var id = createId(prop);
    $tr.attr('id', id);
    $tr.append($locationTd);
    $tr.append($countryTd);
    $tr.append($linkTd);

    $tbody.append($tr);

    var marker = L.marker(prop.loc).addTo(mymap);
    marker.on('click', function() {
      window.location.hash = id;

      // Highlight this row in the table too
      $tr.siblings('.table-active').removeClass('table-active');
      $tr.addClass('table-active');
    });
  }
}

$(function() {
  renderPropsals(document.getElementById('proposals-tbody'), window.PROPOSALS);
});
  </script>
</html>
